{
  "comments":[
    {
      "comment":"Issue Type: <b>Bug</b>\r\n\r\nI am trying to debug a powershell script in VSCode and as soon as I enter the parameter values, I get random auto entered text (see attached photos).\r\n\r\n![Screen Shot 2021-04-01 at 11 13 30 AM](https://user-images.githubusercontent.com/18578295/113316142-03413e80-92dc-11eb-8b92-80d85e7a0dab.png)\r\n\r\n![Screen Shot 2021-04-01 at 11 13 44 AM](https://user-images.githubusercontent.com/18578295/113315886-c1b09380-92db-11eb-9ca1-9501130ac7b1.png)\r\n\r\n\r\n\r\nI attempted to ctrl+c but that still continues to auto enter text.\r\n\r\nOnly way to stop this is by terminating the terminal session.\r\n\r\n\r\n\r\n\r\n\r\nVS Code version: Code 1.55.0 (c185983a683d14c396952dd432459097bc7f757f, 2021-03-30T16:01:05.981Z)\r\nOS version: Darwin x64 20.3.0\r\n\r\n<details>\r\n<summary>System Info</summary>\r\n\r\n|Item|Value|\r\n|---|---|\r\n|CPUs|Intel(R) Core(TM) i9-9980HK CPU @ 2.40GHz (16 x 2400)|\r\n|GPU Status|2d_canvas: enabled<br>gpu_compositing: enabled<br>metal: disabled_off<br>multiple_raster_threads: enabled_on<br>oop_rasterization: enabled<br>opengl: enabled_on<br>protected_video_decode: unavailable_off<br>rasterization: enabled<br>skia_renderer: disabled_off_ok<br>video_decode: enabled<br>webgl: enabled<br>webgl2: enabled|\r\n|Load (avg)|2, 2, 2|\r\n|Memory (System)|32.00GB (5.17GB free)|\r\n|Process Argv|--crash-reporter-id bcf56f26-dca7-4c02-b3c2-69e2861263d0|\r\n|Screen Reader|no|\r\n|VM|0%|\r\n</details><details><summary>Extensions (33)</summary>\r\n\r\nExtension|Author (truncated)|Version\r\n---|---|---\r\nterraform|4op|0.2.1\r\nbetter-comments|aar|2.1.0\r\naws-toolkit-vscode|ama|1.22.0\r\nvscode-bicep|Azu|0.1.37-alpha.gf88c6d95ad\r\narmview|ben|0.4.5\r\nbracket-select|chu|2.0.2\r\nbracket-pair-colorizer|Coe|1.0.61\r\nbracket-pair-colorizer-2|Coe|0.2.0\r\ngitlens|eam|11.3.0\r\nprettier-vscode|esb|6.3.1\r\nterraform|has|2.9.1\r\nazure-pipelines|ms-|1.183.0\r\nvscode-azureappservice|ms-|0.21.2\r\nvscode-azurefunctions|ms-|1.3.0\r\nvscode-azureresourcegroups|ms-|0.3.0\r\nvscode-azureterraform|ms-|0.3.2\r\nvscode-bicep|ms-|0.3.126\r\nvscode-docker|ms-|1.11.0\r\ncsharp|ms-|1.23.9\r\nvscode-dotnet-runtime|ms-|1.0.0\r\nvscode-aks-tools|ms-|0.0.8\r\nvscode-kubernetes-tools|ms-|1.3.0\r\npython|ms-|2021.3.680753044\r\njupyter|ms-|2021.5.702919634\r\nremote-containers|ms-|0.166.0\r\nazure-account|ms-|0.9.7\r\nazurecli|ms-|0.5.0\r\npowershell|ms-|2021.2.2\r\nazurerm-vscode-tools|msa|0.15.0\r\nvscode-yaml|red|0.17.0\r\nmarkdown-preview-enhanced|shd|0.5.17\r\nvscode-ansible|vsc|0.6.0\r\narm-params-generator|wil|1.0.0\r\n\r\n\r\n</details><details>\r\n<summary>A/B Experiments</summary>\r\n\r\n```\r\nvsliv368:30146709\r\nvsreu685:30147344\r\npython383cf:30185419\r\npythonvspyt678:30270856\r\nvspor879:30202332\r\nvspor708:30202333\r\nvspor363:30204092\r\nvstry244:30276681\r\npythonvsdeb440:30248342\r\npythonvsded773:30248341\r\npythonvspyt875:30259475\r\npythonvspyt639:30281910\r\npythontbcf:30265426\r\nwslfolderdoccf:30282075\r\nvspre833cf:30267465\r\npythonptprofiler:30281270\r\nvshan820cf:30276953\r\npythondataviewer:30283453\r\n\r\n```\r\n\r\n</details>\r\n\r\n<!-- generated by issue reporter -->",
      "user":"kishsal"
    },
    {
      "comment":"Performed the following troubleshooting steps:\r\n- Restarted app\r\n- Restarted laptop\r\n- Deleted powershell extension and reinstalled\r\n- Deleted VSCode and Extensions from laptop and reinstalled along with Powershell. \r\n\r\nThe issue only occurs when I attempt to debug a powershell script",
      "user":"kishsal"
    },
    {
      "comment":"IM SUFFERING OF THIS 2 WEEKS HORRIBLE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n\r\njust lost my time installing powershell 7.1.3 thinking that was ps beta problem...\r\n\r\nthis is one of the most irritating bugs iÂ´ve seen in years...\r\n\r\ni love to type extremely fast... and i do a lot of unecessary enters (to clear the screen) and a bunch of \"cls\" enter to clear screen like a psycho... since DOS era i do this... to clear my mind...\r\n\r\nnow imagine you type cls and then the screen clears, and u got a \";1R\" typed for you like a special gift\r\nso you do more enters to get cursor in a more confortable eye level... but ;1R was consolidated and u got a pause... and a error... hey i dunno whatÂ´s ;1R  (and that starts to repeat a lot lol)\r\n\r\nvery bad\r\n\r\nworse: itÂ´s random... sometimes is stop doing this... other times it cames with a big phrase full of mnemonic bug like that one on description\r\n\r\n\r\n:D",
      "user":"VanderSP"
    },
    {
      "comment":"Been suffering for weeks myself. Not sure if this is vscode or vscode-powershell bug tbh. I've only been able to repro in Powershell integrated terminal while using my debian-based devcontainers. PowerShell integrated terminal on Windows directly hasn't shown this yet, but I guess they work fundamentally different since pasting in devcontainer terminal is **super-slow**.\r\n\r\nResizing vscode windows can sometimes stop it.\r\nWith \"escape sequence logging\" enabled, the dev tools console keeps repeating like the sample below automatically:\r\n\r\n<details>\r\n  <summary>Escape sequence logging sample</summary>\r\n\r\n  > LogService.ts:66 xterm.js: parsing data \u001b[6n\r\n> LogService.ts:66 xterm.js: sending data \"\u001b[5;103R\" (8)Â [27, 91, 53, 59, 49, 48, 51, 82]\r\n> LogService.ts:66 xterm.js: parsing data \u001b[6n\r\n> LogService.ts:66 xterm.js: sending data \"\u001b[5;103R\" (8)Â [27, 91, 53, 59, 49, 48, 51, 82]\r\n> LogService.ts:66 xterm.js: parsing data \u001b[?25l\u001b[5;24H\u001b[93minvoke-pester\u001b[39;49m \u001b[37m./Samples/demoIssue1891.tests.ps1\u001b[39;49m \u001b[90m-FullNameFilter\u001b[39;49m \u001b[36m\"get-emoji\"\u001b[37m;\u001b[93m99R\u001b[37m;\u001b[36m\" -Output Diagnostic\r\n> LogService.ts:66 xterm.js: parsing data \u001b[39;49m\u001b[0m\u001b[5;104H\u001b[?12l\u001b[?25h\r\n> LogService.ts:66 xterm.js: parsing data \u001b[?25l\u001b[5;24H\u001b[93minvoke-pester\u001b[39;49m \u001b[37m./Samples/demoIssue1891.tests.ps1\u001b[39;49m \u001b[90m-FullNameFilter\u001b[39;49m \u001b[36m\"get-emoji\"\u001b[37m;\u001b[93m99R\u001b[37m;\u001b[93m1\" -Output Diagnostic\u001b[39;49m\u001b[0m\r\n> LogService.ts:66 xterm.js: parsing data \u001b[5;105H\u001b[?12l\u001b[?25h\r\n> LogService.ts:66 xterm.js: parsing data \u001b[?25l\u001b[5;24H\u001b[93minvoke-pester\u001b[39;49m \u001b[37m./Samples/demoIssue1891.tests.ps1\u001b[39;49m \u001b[90m-FullNameFilter\u001b[39;49m \u001b[36m\"get-emoji\"\u001b[37m;\u001b[93m99R\u001b[37m;\u001b[93m10\" -Output Diagnostic\r\n> LogService.ts:66 xterm.js: parsing data \u001b[39;49m\u001b[0m\u001b[5;106H\u001b[?12l\u001b[?25h\r\n> LogService.ts:66 xterm.js: parsing data \u001b[?25l\u001b[5;24H\r\n> LogService.ts:66 xterm.js: parsing data \u001b[93minvoke-pester\u001b[39;49m \u001b[37m./Samples/demoIssue1891.tests.ps1\u001b[39;49m \u001b[90m-FullNameFilter\u001b[39;49m \u001b[36m\"get-emoji\"\u001b[37m;\u001b[93m99R\u001b[37m;\u001b[93m103\" -Output Diagnostic\u001b[39;49m\u001b[0m\u001b[5;107H\u001b[?12l\u001b[?25h\r\n> LogService.ts:66 xterm.js: parsing data \u001b[?25l\u001b[5;24H\r\n> LogService.ts:66 xterm.js: parsing data \u001b[93minvoke-pester\u001b[39;49m \u001b[37m./Samples/demoIssue1891.tests.ps1\u001b[39;49m \u001b[90m-FullNameFilter\u001b[39;49m \u001b[36m\"get-emoji\"\u001b[37m;\u001b[93m99R\u001b[37m;\u001b[93m103R\" -Output Diagnostic\u001b[39;49m\u001b[0m\u001b[5;108H\u001b[?12l\u001b[?25h\r\n> LogService.ts:66 xterm.js: parsing data \u001b[6n\r\n> LogService.ts:66 xterm.js: sending data \"\u001b[5;108R\" (8)Â [27, 91, 53, 59, 49, 48, 56, 82]\r\n> LogService.ts:66 xterm.js: parsing data \u001b[6n\r\n> LogService.ts:66 xterm.js: sending data \"\u001b[5;108R\" (8)Â [27, 91, 53, 59, 49, 48, 56, 82]\r\n</details>\r\n\r\nPossible repro:\r\n1. Use latest VSCode stable or insider with latest **ms-vscode-powershell** and **ms-vscode-remote.remote-containers**\r\n2. Open a devcontainer using plain image `mcr.microsoft.com/vscode/devcontainers/dotnetcore:0-3.1` and **ms-vscode.powershell** extension enabled in container.\r\n3. Open a .ps1 file to start the PowerShell integrated console\r\n4. Paste `invoke-pester ./Samples/demoIssue1891.tests.ps1 -FullNameFilter \"get-emoji\" -Output Diagnostic`\r\n5. Add another double-quote after `get-emoji` so it becomes `...meFilter \"get-emoji\"\" -Output....`. Problem will hopefully occur.\r\n",
      "user":"fflaten"
    },
    {
      "comment":"oh i was about to say that I forget to say that im using INSIDER version... but also in stable you saying...\r\nso it can be related to usign remote extension? i use it also for wsl2\r\n\r\ni dunno if we are talking about same issues, because i seen lately here on issues, 3 kinds of similar but i dunno if different problems related to terminal lately!",
      "user":"VanderSP"
    },
    {
      "comment":"I'm seeing lots of similar random string -- that look like terminal control strings -- `24;17R` --- etc. \r\n\r\nthis occurs primarily when in a pwsh session or running a pwsh script.\r\n\r\nI've disabled all but WSL and still occured.. Does not occur in normal Terminal only in VS code.\r\n\r\n```Microsoft Windows [Version 10.0.19042.906]```\r\n```Linux scicoria-sl 5.4.72-microsoft-standard-WSL2 #1 SMP Wed Oct 28 23:40:43 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux```\r\n\r\nextensions\r\n```\r\nesbenp.prettier-vscode\r\nms-azure-devops.azure-pipelines\r\nms-azuretools.vscode-azurefunctions\r\nms-azuretools.vscode-azureresourcegroups\r\nms-azuretools.vscode-azurestaticwebapps\r\nms-azuretools.vscode-azurestorage\r\nms-azuretools.vscode-docker\r\nms-bigdatatools.vscode-asa\r\nms-dotnettools.csharp\r\nms-dotnettools.vscode-dotnet-runtime\r\nms-python.python\r\nms-python.vscode-pylance\r\nms-toolsai.jupyter\r\nms-vscode.azure-account\r\nms-vscode.azurecli\r\nms-vsliveshare.vsliveshare\r\nmsazurermtools.azurerm-vscode-tools\r\nvscode.docker\r\nvscode.yaml\r\n```\r\n",
      "user":"cicorias"
    },
    {
      "comment":"yeah, very annoying! Specially because arrow up keys nowadays uses the start of the word to lock filter... so u need to backspace the random chars... weeks already....",
      "user":"VanderSP"
    },
    {
      "comment":"It only happens when using the integrated terminal for me. Tried starting in a temporary terminal, no extensions, reinstall, nothing works. \n\nUPDATE: It is extremely random for me, it can start the moment the pwsh terminal opens, with or without a file open, but most of the time it happens as soon as I hit a breakpoint while debugging. It's then when it's almost certain to show up the moment I start using the terminal window. I've tried to systematically type specific keys to see if they are linked but it still ends up being random. \n\nSometimes it'll just throw a few random characters, and I'll be able to delete them continue debugging for a little bit, other times the moment it starts it's an endless stream and I have to kill the window. ",
      "user":"coreylista"
    },
    {
      "comment":"I've also been experiencing this for the last few weeks.\r\n\r\nJust today I was able to get it to surprisingly stop and regain control of the console.\r\n\r\nThe circumstances for how it starts in the first place though are still a bit of mystery, but generally speaking it occurs for me after I've executed \"a lot\" of arbitrary commands in the Integrated Terminal.\r\n\r\nThen it seems to be triggered when I hit the Up Arrow or if I try to ctl+c.\r\n\r\nIf it's the Up Arrow key only a little bit of text is output. If I ctl+c a lot of text seems to be generated.\r\n\r\nIn either case, a combination of pressing the left, up, and down arrow keys, in no immediately discernible number of occurrences or order will cause it to stop.\r\n\r\nWhen it does finally stop. I have to delete all the randomly generated characters from the current line and then Clear-Host to regain control of the console. Failure to do this will result in it starting again. I'll get a video if I can.",
      "user":"phatmandrake"
    },
    {
      "comment":"just to be clear, I'm seeing this with PowerShell Core sessions only. I've also seen this on plain old macOS using pwsh core 7.x latest too.  \r\n",
      "user":"cicorias"
    },
    {
      "comment":"im 2 weeks getting this horrible bug... in under wsl2... \r\n\r\ntip: fast way to get the problem\r\n\r\nstart terminal\r\n\r\ntype\r\n\r\ncls   enter\r\n\r\nu get             ;1R",
      "user":"VanderSP"
    },
    {
      "comment":"I've seen this happen in the non-integrated terminal. It was just a normal VS Code terminal running `pwsh`, with no PowerShell extension installed.",
      "user":"andschwa"
    },
    {
      "comment":"I know he's an assignee but paging @Tyriar if he's aware of any recent changes that may be related.",
      "user":"JustinGrote"
    },
    {
      "comment":"Sorry about this, I plan to look at it soon. This might workaround the problem:\r\n\r\n```\r\n\"terminal.integrated.localEchoLatencyThreshold\": -1\r\n```",
      "user":"Tyriar"
    },
    {
      "comment":"> Sorry about this, I plan to look at it soon. This might workaround the problem:\r\n> \r\n> ```\r\n> \"terminal.integrated.localEchoLatencyThreshold\": -1\r\n> ```\r\n\r\nðŸŽ‰ðŸŽ‰Thank you @Tyriar ! That solved my reproducable scenario. I might finally be able to work again! ðŸ˜„ \r\n",
      "user":"fflaten"
    },
    {
      "comment":"Thanks @Tyriar!",
      "user":"andschwa"
    },
    {
      "comment":"This is again caused by `writeSync` which was what caused the issue a couple of weeks ago, flushing the output using it is causing a double write of the cursor report response and pwsh handles an unexpected cursor report by just echoing it.\r\n\r\n```\r\nterminalProcessManager.js:87 on before data \u001b[6n\r\nterminalInstance.js:851 xterm write: \"\\u001b[6n\"\r\nterminalProcessManager.js:399 process write: \"\\u001b[11;1R\"\r\nterminalProcessManager.js:399 process write: \"\\u001b[11;1R\"\r\n```",
      "user":"Tyriar"
    },
    {
      "comment":"@connor4312 I needed to disable flushing of output as it's no longer possible to do this without adding async everywhere which would be a huge change to the addon. It's not clear what the problem is getting fixed in f82ff2194fc81ed0d0ca87018fc5526dfc1946e8 and b97bb4e8b95210427d615a470161b795b894991c is but I'm pretty sure those issues won't be worth than this one which basically renders pwsh unusable.",
      "user":"Tyriar"
    },
    {
      "comment":"I think the no-oping you did in https://github.com/microsoft/vscode/commit/14b07fe6e752926d51ae6d6c19ddcac3c6400900 is the best we can do for now. We'd really need https://github.com/microsoft/vscode/issues/115949 in order to handle this properly without writeSync.",
      "user":"connor4312"
    },
    {
      "comment":"> Sorry about this, I plan to look at it soon. This might workaround the problem:\r\n> \r\n> ```\r\n> \"terminal.integrated.localEchoLatencyThreshold\": -1\r\n> ```\r\n\r\nThank you @Tyriar.  This did the trick for now.",
      "user":"kishsal"
    },
    {
      "comment":"YES THIS SOLVED for me\r\n\r\nwsl2 pengwin... powershell 7... vscode insider... win insider",
      "user":"VanderSP"
    },
    {
      "comment":"Author verified, adding verified label to not appear in verification query",
      "user":"isidorn"
    },
    {
      "comment":"I'm seeing similar issue again while still using the @Tyriar's workaround in settings. It doesn't start at random in existing consoles like the original issue, but it starts after reloading window in the same devcontainer.\r\n\r\n1. In devcontainer with PS integrated console open\r\n2. Reload Window\r\n3. VsCode starts a new PS integrated consoel, but auto-focuses on \"<number>: pwsh\" terminal which is the original console from step 1. In this console, the control characters keep going for a while. Sometimes 2sec, sometimes more.\r\n\r\nThis was not happening after the workaround was provided. Changes in latest vscode?\r\nNow running VSCode Stable 1.56.2 w/vscode-powershell 2021.2.2\r\n\r\n![reload-randomchar](https://user-images.githubusercontent.com/3436158/118405509-82b28380-b678-11eb-8713-b88749114e21.gif)\r\n\r\n\r\n",
      "user":"fflaten"
    },
    {
      "comment":"@fflaten should be fixed with https://github.com/microsoft/vscode/issues/123803",
      "user":"Tyriar"
    }
  ],
  "repository":"vscode",
  "user":"kishsal"
}